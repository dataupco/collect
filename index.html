<!doctype html>
<html>
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge">
    <meta name="viewport" content="width=device-width">
    <title>Data Up!</title>
    <script>
  function setup() {
     var signinLink = document.getElementById('signin');
     if (signinLink) {
       signinLink.onclick = function() { navigator.id.request(); };
     }

     var signoutLink = document.getElementById('signout');
     if (signoutLink) {
       signoutLink.onclick = function() { navigator.id.logout(); };
     }

     navigator.id.watch({
       onlogin : function(assertion) { 
       //alert('login');
               $.ajax({ 
                  type: 'POST',
                  url: '/auth/login', 
                  data: {assertion: assertion},
                  success: function(res, status, xhr) { alert('login success : ' + JSON.stringify(res)); },
                  error: function(xhr, status, err) {
                    navigator.id.logout();
                    alert("Login failure: " + err);
                   }
               });
       },
       onlogout : function(assertion) {
       alert('logout');
                $.ajax({
                  type: 'POST',
                  url: '/auth/logout', 
                  success: function(res, status, xhr) { alert('logout success'); },
                  error: function(xhr, status, err) { alert("Logout failure: " + err); }
                });
       }
     });
  }
    </script>
  </head>
  <body onLoad="setup()">
   <div clsass="v-outer-div"> 
     <a id="signin" href="#">Sign In</a>
     <a id="signout" href="#">Sign Out</a>
    </div>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    <script src="https://login.persona.org/include.js"></script>
  </body>
</html>
